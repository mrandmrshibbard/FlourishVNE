/**
 * Script to generate gameEngineBundle.ts with the built engine code embedded
 * Run this after building the standalone player
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const enginePath = path.join(__dirname, '../dist-standalone/game-engine.js');
const outputPath = path.join(__dirname, '../src/utils/gameEngineBundle.ts');

console.log('üì¶ Reading game engine bundle...');

if (!fs.existsSync(enginePath)) {
  console.error('‚ùå Error: Game engine not found!');
  console.error('   Please run: npm run build:standalone');
  process.exit(1);
}

const engineCode = fs.readFileSync(enginePath, 'utf-8');
const engineSize = (engineCode.length / 1024).toFixed(2);

console.log(`‚úì Loaded game engine (${engineSize} KB)`);
console.log('üìù Generating gameEngineBundle.ts...');

// Escape backticks and ${} in the code
const escapedCode = engineCode
  .replace(/\\/g, '\\\\')
  .replace(/`/g, '\\`')
  .replace(/\$/g, '\\$');

const output = `/**
 * AUTO-GENERATED FILE - DO NOT EDIT
 * Generated by: npm run generate:engine-bundle
 * Source: dist-standalone/game-engine.js
 * Size: ${engineSize} KB
 */

export const GAME_ENGINE_BUNDLE = \`${escapedCode}\`;

export function getGameEngineCode(): string {
  return GAME_ENGINE_BUNDLE;
}
`;

fs.writeFileSync(outputPath, output, 'utf-8');

console.log(`‚úì Generated ${outputPath}`);
console.log(`‚úì Bundle size: ${engineSize} KB`);
console.log('‚úÖ Done!');
